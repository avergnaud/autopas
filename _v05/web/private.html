<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PAS Assistant</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>

<header>
  <span class="app-title">PAS Assistant</span>
  <span id="user-info" class="user-info"></span>
  <a href="/auth/logout" class="btn btn-small">Se d√©connecter</a>
</header>

<main>

  <!-- ‚îÄ‚îÄ Vue : liste des projets ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <section id="view-projects">
    <div class="section-header">
      <h2>Mes questionnaires</h2>
      <button onclick="startNewProject()" class="btn btn-primary">+ Nouveau questionnaire</button>
    </div>
    <div id="projects-list"></div>
  </section>

  <!-- ‚îÄ‚îÄ √âtape 1 : Upload ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <section id="step-upload" class="wizard-step hidden">
    <div class="step-header">
      <button onclick="showProjects()" class="btn btn-small btn-ghost">‚Üê Retour</button>
      <nav class="step-indicator">
        <span class="step active">1&nbsp;Import</span>
        <span class="step-sep">‚Ä∫</span><span class="step">2&nbsp;Structure</span>
        <span class="step-sep">‚Ä∫</span><span class="step">3&nbsp;Cadrage</span>
        <span class="step-sep">‚Ä∫</span><span class="step">4&nbsp;Anonymisation</span>
        <span class="step-sep">‚Ä∫</span><span class="step">5&nbsp;G√©n√©ration</span>
      </nav>
    </div>

    <h2>Importer un questionnaire</h2>
    <p>D√©posez votre fichier (.xlsx ou .docx). Claude analysera automatiquement sa structure.</p>

    <div class="upload-zone" id="drop-zone">
      <div class="upload-icon">üìÑ</div>
      <p>Glissez-d√©posez votre fichier ici</p>
      <p class="hint">ou</p>
      <label class="btn btn-secondary">
        Parcourir‚Ä¶
        <input type="file" id="file-input" accept=".xlsx,.docx" style="display:none">
      </label>
      <p class="hint small">Formats : .xlsx, .docx ‚Äî max 50 Mo</p>
    </div>

    <p id="selected-file" class="selected-file hidden"></p>
    <p id="upload-error" class="error-msg hidden"></p>

    <div id="upload-loading" class="loading-box hidden">
      <div class="spinner"></div>
      <span>Analyse de la structure en cours (Claude)‚Ä¶</span>
    </div>

    <div class="btn-row">
      <button id="btn-upload" class="btn btn-primary hidden" onclick="doUpload()">
        Analyser le fichier ‚Üí
      </button>
    </div>
  </section>

  <!-- ‚îÄ‚îÄ √âtape 2 : Structure ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <section id="step-structure" class="wizard-step hidden">
    <div class="step-header">
      <nav class="step-indicator">
        <span class="step done">1&nbsp;Import</span>
        <span class="step-sep">‚Ä∫</span><span class="step active">2&nbsp;Structure</span>
        <span class="step-sep">‚Ä∫</span><span class="step">3&nbsp;Cadrage</span>
        <span class="step-sep">‚Ä∫</span><span class="step">4&nbsp;Anonymisation</span>
        <span class="step-sep">‚Ä∫</span><span class="step">5&nbsp;G√©n√©ration</span>
      </nav>
    </div>

    <h2>Confirmer la structure d√©tect√©e</h2>
    <p>Claude a analys√© la structure de votre document. V√©rifiez et corrigez si n√©cessaire.</p>

    <div id="structure-form"></div>
    <p id="structure-error" class="error-msg hidden"></p>

    <div class="btn-row">
      <button onclick="showStep('upload')" class="btn btn-secondary">‚Üê Pr√©c√©dent</button>
      <button onclick="doValidateStructure()" class="btn btn-primary">Valider ‚Üí</button>
    </div>
  </section>

  <!-- ‚îÄ‚îÄ √âtape 3 : Cadrage ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <section id="step-cadrage" class="wizard-step hidden">
    <div class="step-header">
      <nav class="step-indicator">
        <span class="step done">1&nbsp;Import</span>
        <span class="step-sep">‚Ä∫</span><span class="step done">2&nbsp;Structure</span>
        <span class="step-sep">‚Ä∫</span><span class="step active">3&nbsp;Cadrage</span>
        <span class="step-sep">‚Ä∫</span><span class="step">4&nbsp;Anonymisation</span>
        <span class="step-sep">‚Ä∫</span><span class="step">5&nbsp;G√©n√©ration</span>
      </nav>
    </div>

    <h2>Questions de cadrage</h2>

    <div id="cadrage-question-container"></div>
    <p id="cadrage-error" class="error-msg hidden"></p>

    <div class="btn-row">
      <button id="btn-cadrage-prev" onclick="cadrageBack()" class="btn btn-secondary">‚Üê Pr√©c√©dent</button>
      <button id="btn-cadrage-next" onclick="cadrageNext()" class="btn btn-primary">Suivant ‚Üí</button>
    </div>
  </section>

  <!-- ‚îÄ‚îÄ √âtape 4 : Anonymisation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <section id="step-anonymisation" class="wizard-step hidden">
    <div class="step-header">
      <nav class="step-indicator">
        <span class="step done">1&nbsp;Import</span>
        <span class="step-sep">‚Ä∫</span><span class="step done">2&nbsp;Structure</span>
        <span class="step-sep">‚Ä∫</span><span class="step done">3&nbsp;Cadrage</span>
        <span class="step-sep">‚Ä∫</span><span class="step active">4&nbsp;Anonymisation</span>
        <span class="step-sep">‚Ä∫</span><span class="step">5&nbsp;G√©n√©ration</span>
      </nav>
    </div>

    <h2>Anonymisation</h2>
    <p>
      Renseignez les mots √† remplacer avant l'envoi √† l'API Claude.
      La substitution inverse sera effectu√©e dans le document final.
      Cette √©tape est <strong>optionnelle</strong>.
    </p>

    <table class="anon-table">
      <thead>
        <tr>
          <th>Mot r√©el (dans le document)</th>
          <th>Alias anonymis√©</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="anon-rows"></tbody>
    </table>
    <button onclick="addAnonRow()" class="btn btn-secondary btn-small" style="margin-top:.5rem">
      + Ajouter un mot
    </button>

    <p id="anon-error" class="error-msg hidden"></p>

    <div class="btn-row">
      <button onclick="showStep('cadrage'); renderCadrageQuestion();" class="btn btn-secondary">‚Üê Pr√©c√©dent</button>
      <button onclick="doAnonymize(false)" class="btn btn-outline">Passer cette √©tape</button>
      <button onclick="doAnonymize(true)" class="btn btn-primary">Lancer le traitement ‚Üí</button>
    </div>
  </section>

  <!-- ‚îÄ‚îÄ √âtape 5 : G√©n√©ration ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <section id="step-generation" class="wizard-step hidden">
    <div class="step-header">
      <nav class="step-indicator">
        <span class="step done">1&nbsp;Import</span>
        <span class="step-sep">‚Ä∫</span><span class="step done">2&nbsp;Structure</span>
        <span class="step-sep">‚Ä∫</span><span class="step done">3&nbsp;Cadrage</span>
        <span class="step-sep">‚Ä∫</span><span class="step done">4&nbsp;Anonymisation</span>
        <span class="step-sep">‚Ä∫</span><span class="step active">5&nbsp;G√©n√©ration</span>
      </nav>
    </div>

    <h2>G√©n√©ration</h2>

    <!-- En cours -->
    <div id="gen-in-progress">
      <div class="spinner large"></div>
      <p id="gen-step-label" class="gen-step">Traitement en cours‚Ä¶</p>
      <div class="progress-track">
        <div class="progress-bar" id="gen-progress-bar" style="width:0%"></div>
      </div>
      <ol id="gen-pipeline-steps" class="pipeline-steps"></ol>
    </div>

    <!-- Termin√© -->
    <div id="gen-complete" class="hidden">
      <div class="success-box">
        <span class="success-icon">‚úì</span>
        <strong>Traitement termin√© !</strong>
      </div>
      <div class="download-grid">
        <a id="btn-dl-doc" class="btn btn-primary" href="#" download>
          ‚¨á T√©l√©charger le questionnaire rempli
        </a>
        <a id="btn-dl-attention" class="btn btn-secondary" href="#" download>
          ‚¨á T√©l√©charger les points d'attention
        </a>
      </div>
      <div class="btn-row" style="margin-top:1.5rem">
        <button onclick="showProjects()" class="btn btn-outline">‚Üê Retour √† mes projets</button>
      </div>
    </div>

    <!-- Erreur -->
    <div id="gen-error" class="hidden">
      <div class="error-box">
        <p id="gen-error-msg"></p>
      </div>
      <div class="btn-row">
        <button onclick="showProjects()" class="btn btn-secondary">‚Üê Retour</button>
        <button onclick="retryGeneration()" class="btn btn-primary">R√©essayer</button>
      </div>
    </div>
  </section>

</main>

<script src="/app.js"></script>
</body>
</html>
